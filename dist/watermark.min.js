!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.waterMarker=t():e.waterMarker=t()}(self,(()=>(()=>{"use strict";var e=[,function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{u(n.next(e))}catch(e){a(e)}}function c(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.imgWaterMarker=void 0;var u=r(2),s=r(3),l=r(4),f=a(r(5));t.imgWaterMarker=function(e){var t=this;return new Promise((function(r,n){return i(t,void 0,void 0,(function(){var t,o,a,i,h,d,p,b,v,g,w,y,m,_,x,k,P;return c(this,(function(c){switch(c.label){case 0:return function(e,t){if(!e.src)throw(0,f.error)("请输入图片地址"),t("请输入图片地址"),new f.default(1,"configError");e.text||(0,f.warn)("请配置水印文字");if(!["","png","jpeg"].includes(e.output||""))throw(0,f.error)("不支持".concat(e.output,"类型")),t("不支持".concat(e.output,"类型")),new f.default(1,"configError")}(e,n),t=e.src,o=e.text,a=e.size,i=e.color,h=e.padding,d=e.output,p=e.position,b=e.rotate,v=e.type,g=void 0===v?"fill":v,[4,(0,u.createImgInstance)({source:t,onError:function(){return(0,f.error)("注意-一个无法打开的图片资源")}})];case 1:return w=c.sent(),y=(0,s.createCanvas)(),m=y.canvas,_=y.ctx,x=w.width,k=w.height,m.width=x,m.height=k,_.drawImage(w,0,0,x,k),_.font="".concat(a||20,"px bold italic arial"),(P=_.createLinearGradient(100,200,200,200)).addColorStop(1,i||"#ccc"),_.fillStyle=P,function(e,t,r,n,o,a,i,c){void 0===n&&(n=30);var u=(0,l.getTextBound)(e,t||"Jimmy定制");if(o<u.width+n||a<u.height+n)throw(0,f.error)("图片太小或水印文字太大"),new f.default(2,"图片太小或水印文字太大");var s=0,h=0;switch((0,l.getPositionType)(r)){case 1:s=n,h=n;break;case 2:s=n,h=a/2-u.height/2;break;case 3:s=n,h=a-u.height-n;break;case 4:s=o/2-u.width/2,h=n;break;case 5:s=o/2-u.width/2,h=a/2-u.height/2;break;case 6:s=o/2-u.width/2,h=a-u.height-n;break;case 7:s=o-u.width-n,h=n;break;case 8:s=o-u.width-n,h=a/2-u.height/2;break;case 9:s=o-u.width-n,h=a-u.height-n}if(c){var d={x:s+u.width/2,y:h+u.height/2};e.translate(d.x,d.y),e.rotate(c*Math.PI/180),e.translate(-d.x,-d.y)}"fill"===i?e.fillText(t||"watermark",s,h):e.strokeText(t||"watermark",s,h)}(_,o,p||"right-bottom",h,x,k,g,b),r(m.toDataURL("image/".concat(d,"||jpeg"))),[2]}}))}))}))}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createImgInstance=void 0,t.createImgInstance=function(e){var t=e.source,r=e.onError;return new Promise((function(e,n){var o=new Image;o.setAttribute("crossOrigin",""),o.src=t,o.onload=function(){e(o)},o.onerror=r}))}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCanvas=void 0,t.createCanvas=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return{canvas:e,ctx:t}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.gaussBlur=t.getPositionType=t.getTextBound=void 0;t.getTextBound=function(e,t){var r=e.measureText(t);return{width:r.width,height:r.actualBoundingBoxDescent}};t.getPositionType=function(e){var t;switch(e){case"left-top":t=1;break;case"left-center":t=2;break;case"left-bottom":t=3;break;case"center-top":t=4;break;case"center":t=5;break;case"center-bottom":t=6;break;case"right-top":t=7;break;case"right-center":t=8;break;case"right-bottom":t=9}return t},t.gaussBlur=function(e,t){t*=3;var r,n,o,a,i,c,u,s,l,f,h=new Uint8ClampedArray(e.data),d=e.width,p=e.height,b=[],v=0,g=(t=Math.floor(t))/3;for(c=1/(Math.sqrt(2*Math.PI)*g),i=-1/(2*g*g),u=-t;u<=t;u++)b.push(c*Math.exp(i*u*u));for(n=0;n<p;n++)for(r=0;r<d;r++){for(o=a=i=c=v=0,s=-t;s<=t;s++)(l=r+s)>=0&&l<d&&(u=4*(n*d+l),f=b[s+t],o+=h[u]*f,a+=h[u+1]*f,i+=h[u+2]*f,c+=h[u+3]*f,v+=f);u=4*(n*d+r),e.data.set([o,a,i,c].map((function(e){return e/v})),u)}for(h.set(e.data),r=0;r<d;r++)for(n=0;n<p;n++){for(o=a=i=c=v=0,s=-t;s<=t;s++)(l=n+s)>=0&&l<p&&(u=4*(l*d+r),f=b[s+t],o+=h[u]*f,a+=h[u+1]*f,i+=h[u+2]*f,c+=h[u+3]*f,v+=f);u=4*(n*d+r),e.data.set([o,a,i,c].map((function(e){return e/v})),u)}return e}},function(e,t){var r,n,o=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.error=t.warn=void 0,function(e){e[e.ConfigError=1]="ConfigError",e[e.RenderError=2]="RenderError",e[e.SourceError=3]="SourceError"}(n||(n={}));t.warn=function(e){};t.error=function(e){};var a=function(e){function t(t,r){var o=e.call(this)||this;switch(t){case n.ConfigError:o.name=n[n.ConfigError],o.message=r;break;case n.RenderError:o.name=n[n.RenderError],o.message=r;break;case n.SourceError:o.name=n[n.SourceError],o.message=r}return o}return o(t,e),t}(Error);t.default=a},function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{u(n.next(e))}catch(e){a(e)}}function c(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.mosaic=void 0;var a=r(2),i=r(3),c=r(5);t.mosaic=function(e){var t=this,r=e.src,u=e.output,s=void 0===u?"jpeg":u,l=e.size,f=void 0===l?8:l;return new Promise((function(e,u){return n(t,void 0,void 0,(function(){var t,n,u,l,h,d,p,b,v,g,w,y,m,_,x;return o(this,(function(o){switch(o.label){case 0:return[4,(0,a.createImgInstance)({source:r,onError:function(){return(0,c.error)("注意-一个无法打开的图片资源")}})];case 1:for(t=o.sent(),n=(0,i.createCanvas)(),u=n.canvas,l=n.ctx,h=t.width,d=t.height,u.width=h,u.height=d,l.drawImage(t,0,0,h,d),p=l.getImageData(0,0,h,d),b=p.data,l.fillRect(0,0,h,d),v=0;v<d;v+=f)for(g=0;g<h;g+=f)y=[b[w=4*(v*h+g)],b[w+1],b[w+2]],m=y[0],_=y[1],x=y[2],l.fillStyle="rgb(".concat(m,",").concat(_,",").concat(x,")"),l.beginPath(),l.arc(g,v,f/2,0,2*Math.PI),l.fill();return e(u.toDataURL("image/".concat(s,"||jpeg"))),[2]}}))}))}))}},function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{u(n.next(e))}catch(e){a(e)}}function c(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.blur=void 0;var a=r(2),i=r(3),c=r(5),u=r(4);t.blur=function(e){var t=this,r=e.src,s=e.output,l=void 0===s?"jpeg":s,f=e.radius,h=void 0===f?5:f;return new Promise((function(e,s){return n(t,void 0,void 0,(function(){var t,n,s,f,d,p,b,v;return o(this,(function(o){switch(o.label){case 0:return[4,(0,a.createImgInstance)({source:r,onError:function(){return(0,c.error)("注意-一个无法打开的图片资源")}})];case 1:return t=o.sent(),n=(0,i.createCanvas)(),s=n.canvas,f=n.ctx,d=t.width,p=t.height,s.width=d,s.height=p,f.drawImage(t,0,0,d,p),b=f.getImageData(0,0,d,p),v=(0,u.gaussBlur)(b,h),f.putImageData(v,0,0),e(s.toDataURL("image/".concat(l,"||jpeg"))),[2]}}))}))}))}}],t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}var n={};return(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.blur=e.mosaic=e.marker=void 0;var t=r(1);Object.defineProperty(e,"marker",{enumerable:!0,get:function(){return t.imgWaterMarker}});var o=r(6);Object.defineProperty(e,"mosaic",{enumerable:!0,get:function(){return o.mosaic}});var a=r(7);Object.defineProperty(e,"blur",{enumerable:!0,get:function(){return a.blur}}),e.default={marker:t.imgWaterMarker,mosaic:o.mosaic,blur:a.blur}})(),n=n.default})()));